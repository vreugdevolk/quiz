<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Quiz - Bureau Max</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700;800;900&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --navy: #212c65;
      --navy-dark: #1a2350;
      --coral: #ee6d4e;
      --coral-light: #f48970;
      --coral-dark: #d85a3c;
      --white: #ffffff;
      --gray-100: #f4f6fa;
      --gray-200: #e8ebf4;
      --gray-300: #c5cce0;
      --gray-400: #8892b0;
      --green: #10b981;
      --red: #ef4444;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'DM Sans', -apple-system, sans-serif;
      background: var(--navy);
      min-height: 100vh;
      min-height: -webkit-fill-available;
      color: var(--white);
      padding: 20px;
      padding-bottom: env(safe-area-inset-bottom, 20px);
    }

    .container { max-width: 500px; margin: 0 auto; }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    .header-left {
      display: flex;
      flex-direction: column;
    }

    .player-name {
      font-family: 'Outfit', sans-serif;
      font-size: 1.5rem;
      font-weight: 800;
      color: var(--white);
      letter-spacing: -0.02em;
      line-height: 1.1;
    }

    .subtitle {
      font-size: 0.8rem;
      color: var(--coral);
      font-weight: 500;
    }

    .phase-badge {
      padding: 6px 14px;
      background: var(--coral);
      border-radius: 20px;
      font-family: 'Outfit', sans-serif;
      font-size: 0.75rem;
      font-weight: 600;
      white-space: nowrap;
    }

    .category-badge {
      padding: 6px 14px;
      background: var(--coral);
      border-radius: 20px;
      font-family: 'Outfit', sans-serif;
      font-size: 0.75rem;
      font-weight: 700;
    }

    /* Minimal Score Display */
    .score-display {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding: 0 4px;
    }

    .score-display .score {
      font-family: 'Outfit', sans-serif;
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--coral);
    }

    .score-display .progress {
      font-size: 0.85rem;
      color: var(--gray-300);
    }

    /* Bottom action buttons */
    .bottom-actions {
      display: flex;
      gap: 10px;
      margin-top: 24px;
      padding-top: 20px;
      border-top: 1px solid rgba(255,255,255,0.08);
    }

    .bottom-btn {
      flex: 1;
      padding: 14px 16px;
      font-family: 'DM Sans', sans-serif;
      font-size: 0.9rem;
      font-weight: 600;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
      -webkit-tap-highlight-color: transparent;
    }

    .bottom-btn:active { transform: scale(0.98); }
    .bottom-btn:disabled { opacity: 0.4; cursor: default; }

    .bet-btn {
      background: rgba(255,255,255,0.1);
      color: var(--white);
      border: 2px solid rgba(255,255,255,0.2);
    }

    .bet-btn.placed {
      background: var(--green);
      border-color: var(--green);
    }

    .skip-btn {
      background: rgba(239, 68, 68, 0.1);
      color: var(--red);
      border: 2px solid var(--red);
    }

    .skip-btn.voted {
      background: var(--red);
      color: var(--white);
    }

    /* Footer logo - at bottom of content */
    .footer-logo {
      text-align: center;
      padding: 30px 0 20px 0;
      margin-top: auto;
    }

    .footer-logo img {
      height: 24px;
      width: auto;
      opacity: 0.5;
    }

    /* Hide header during quiz */
    body.playing header { display: none; }

    /* Bet alert - when you have a bet on current question */
    .bet-alert {
      background: linear-gradient(135deg, var(--coral) 0%, var(--coral-dark) 100%);
      color: var(--white);
      text-align: center;
      padding: 12px 16px;
      border-radius: 12px;
      font-weight: 700;
      font-size: 0.95rem;
      margin-bottom: 16px;
    }

    /* Question Card - Clean */
    .question-card {
      margin-bottom: 24px;
    }

    .question-text {
      font-family: 'Outfit', sans-serif;
      font-size: 1.4rem;
      font-weight: 700;
      line-height: 1.35;
      letter-spacing: -0.02em;
      text-align: center;
    }

    .question-number { display: none; }

    .bet-indicator {
      display: inline-block;
      margin-top: 14px;
      padding: 8px 16px;
      background: rgba(238, 109, 78, 0.15);
      border: 2px solid var(--coral);
      border-radius: 30px;
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--coral);
    }

    /* Answer Section */
    .answer-input {
      width: 100%;
      padding: 18px 20px;
      font-family: 'DM Sans', sans-serif;
      font-size: 1.1rem;
      border: 2px solid rgba(255,255,255,0.15);
      border-radius: 14px;
      background: rgba(255,255,255,0.95);
      color: var(--navy);
      margin-bottom: 12px;
      transition: border-color 0.2s;
    }

    .answer-input:focus { outline: none; border-color: var(--coral); }
    .answer-input::placeholder { color: var(--gray-300); }

    .submit-btn {
      width: 100%;
      padding: 18px;
      font-family: 'Outfit', sans-serif;
      font-size: 1.1rem;
      font-weight: 700;
      border: none;
      border-radius: 14px;
      background: linear-gradient(135deg, var(--coral) 0%, var(--coral-dark) 100%);
      color: var(--white);
      cursor: pointer;
      transition: all 0.2s;
      -webkit-tap-highlight-color: transparent;
    }

    .submit-btn:disabled { background: var(--green); cursor: default; }
    .submit-btn:active:not(:disabled) { transform: scale(0.98); }

    .submitted-badge {
      text-align: center;
      padding: 10px;
      margin-top: 16px;
      color: var(--green);
      font-size: 0.9rem;
      font-weight: 600;
    }

    /* Answer Reveal */
    .answer-reveal {
      background: rgba(238, 109, 78, 0.1);
      border: 2px solid var(--coral);
      border-radius: 16px;
      padding: 20px;
      margin-top: 16px;
      text-align: center;
    }

    .answer-reveal .label { font-size: 0.85rem; color: var(--gray-300); margin-bottom: 8px; }
    .answer-reveal .correct-answer { font-family: 'Outfit', sans-serif; font-size: 1.4rem; font-weight: 800; color: var(--coral); }

    .your-answer {
      background: rgba(255,255,255,0.05);
      border-radius: 12px;
      padding: 14px;
      margin-top: 14px;
    }

    .your-answer .label { font-size: 0.75rem; color: var(--gray-300); margin-bottom: 4px; }
    .your-answer .text { font-size: 1rem; }

    .bet-result {
      margin-top: 12px;
      padding: 12px;
      border-radius: 10px;
      font-weight: 600;
      text-align: center;
      background: rgba(238, 109, 78, 0.15);
      color: var(--coral);
    }

    /* Answer result feedback */
    .answer-result {
      text-align: center;
      padding: 20px;
      border-radius: 16px;
      margin-bottom: 16px;
      animation: resultPop 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    .answer-result.correct {
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(16, 185, 129, 0.3) 100%);
      border: 3px solid var(--green);
    }

    .answer-result.wrong {
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.15) 0%, rgba(239, 68, 68, 0.25) 100%);
      border: 3px solid var(--red);
    }

    .answer-result .result-icon {
      font-size: 3rem;
      margin-bottom: 8px;
    }

    .answer-result .result-text {
      font-family: 'Outfit', sans-serif;
      font-size: 1.6rem;
      font-weight: 800;
    }

    .answer-result.correct .result-text { color: var(--green); }
    .answer-result.wrong .result-text { color: var(--red); }

    .answer-result .result-points {
      font-size: 1rem;
      margin-top: 8px;
      opacity: 0.9;
    }

    @keyframes resultPop {
      0% { transform: scale(0.5); opacity: 0; }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); opacity: 1; }
    }

    /* Multiple Choice Buttons */
    .mc-options { display: grid; gap: 10px; margin-bottom: 12px; }

    .mc-option {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 16px 18px;
      background: rgba(255,255,255,0.08);
      border: 2px solid rgba(255,255,255,0.15);
      border-radius: 14px;
      cursor: pointer;
      transition: all 0.2s;
      -webkit-tap-highlight-color: transparent;
    }

    .mc-option:active { transform: scale(0.98); }
    .mc-option.selected { background: rgba(238, 109, 78, 0.2); border-color: var(--coral); }
    .mc-option.correct { background: rgba(16, 185, 129, 0.2); border-color: var(--green); }
    .mc-option.wrong { background: rgba(239, 68, 68, 0.15); border-color: var(--red); opacity: 0.7; }
    .mc-option.disabled { pointer-events: none; opacity: 0.7; }

    .mc-letter {
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
      font-family: 'Outfit', sans-serif;
      font-weight: 700;
      font-size: 1rem;
    }

    .mc-option.selected .mc-letter { background: var(--coral); }
    .mc-option.correct .mc-letter { background: var(--green); }

    .mc-text { flex: 1; font-size: 1rem; line-height: 1.3; }

    /* Number Input */
    .number-input {
      width: 100%;
      padding: 20px;
      font-family: 'Outfit', sans-serif;
      font-size: 2rem;
      font-weight: 700;
      text-align: center;
      border: 2px solid rgba(255,255,255,0.15);
      border-radius: 14px;
      background: rgba(255,255,255,0.95);
      color: var(--navy);
      margin-bottom: 12px;
    }

    .number-input:focus { outline: none; border-color: var(--coral); }

    /* Question Type Badge */
    .question-type-badge {
      display: inline-block;
      padding: 4px 10px;
      background: rgba(255,255,255,0.1);
      border-radius: 6px;
      font-size: 0.7rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-left: 8px;
      color: var(--gray-300);
    }

    /* Waiting Screen */
    .waiting-screen { text-align: center; padding: 50px 20px; }

    .waiting-screen h2 {
      font-family: 'Outfit', sans-serif;
      font-size: 1.8rem;
      font-weight: 800;
      margin-bottom: 15px;
      animation: pulse 2s infinite;
    }

    .waiting-screen p { color: var(--gray-300); font-size: 1rem; }

    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }

    /* Category Voting */
    .approved-info {
      text-align: center;
      padding: 20px;
      background: rgba(238, 109, 78, 0.1);
      border-radius: 16px;
      margin-bottom: 20px;
    }

    .approved-info .count { font-family: 'Outfit', sans-serif; font-size: 3rem; font-weight: 900; color: var(--coral); }
    .approved-info .label { font-size: 0.9rem; color: var(--gray-300); }

    .category-input-row { display: flex; gap: 10px; margin-bottom: 20px; }

    .category-input {
      flex: 1;
      padding: 16px 18px;
      font-family: 'DM Sans', sans-serif;
      font-size: 1rem;
      border: none;
      border-radius: 12px;
      background: rgba(255,255,255,0.95);
      color: var(--navy);
    }

    .category-input:focus { outline: 3px solid var(--coral); }

    .add-category-btn {
      padding: 16px 24px;
      font-family: 'Outfit', sans-serif;
      font-size: 1.2rem;
      font-weight: 700;
      border: none;
      border-radius: 12px;
      background: var(--coral);
      color: var(--white);
      cursor: pointer;
    }

    .category-list { max-height: 300px; overflow-y: auto; }

    .category-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 14px 16px;
      background: rgba(255,255,255,0.05);
      border-radius: 12px;
      margin-bottom: 10px;
      border: 2px solid transparent;
    }

    .category-item.approved { background: rgba(238, 109, 78, 0.15); border-color: var(--coral); }
    .category-item.mine { border-left: 4px solid var(--coral); }

    .category-name { font-weight: 600; flex: 1; }

    .count-badge {
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 700;
      background: rgba(255,255,255,0.15);
    }

    .count-badge.approved { background: var(--coral); }

    .suggesters { font-size: 0.8rem; color: var(--gray-300); margin-top: 4px; }

    /* Leaderboard */
    .leaderboard { margin-top: 24px; }
    .leaderboard h3 { font-family: 'Outfit', sans-serif; font-size: 1rem; font-weight: 700; color: var(--gray-300); margin-bottom: 14px; text-align: center; text-transform: uppercase; letter-spacing: 0.1em; }

    .leaderboard-item {
      display: flex;
      justify-content: space-between;
      padding: 12px 14px;
      background: rgba(255,255,255,0.04);
      border-radius: 10px;
      margin-bottom: 8px;
      font-size: 0.9rem;
    }

    .leaderboard-item.you { background: rgba(238, 109, 78, 0.15); border: 2px solid var(--coral); }
    .leaderboard-item.has-bet { border-left: 3px solid var(--coral); }

    .leaderboard-rank { width: 28px; color: var(--gray-400); }
    .leaderboard-name { flex: 1; font-weight: 500; }
    .leaderboard-score { font-family: 'Outfit', sans-serif; font-weight: 700; color: var(--coral); }

    /* Finished */
    .finished-message { text-align: center; padding: 40px 20px; background: rgba(255,255,255,0.05); border-radius: 20px; }
    .finished-message h2 { font-family: 'Outfit', sans-serif; color: var(--coral); margin-bottom: 20px; font-size: 1.8rem; }
    .your-final-score { font-family: 'Outfit', sans-serif; font-size: 4rem; font-weight: 900; color: var(--coral); margin: 20px 0; }
    .your-final-rank { font-size: 1.2rem; color: var(--gray-300); }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="header-left">
        <div class="player-name" id="playerNameDisplay"></div>
        <div class="subtitle">Quiz night</div>
      </div>
      <div id="phaseBadge"></div>
    </header>

    <div id="mainContent"></div>

    <div class="leaderboard" id="leaderboard" style="display: none;">
      <h3>Scoreboard</h3>
      <div id="leaderboardList"></div>
    </div>
  </div>

  <div class="footer-logo">
    <img src="/bureau_max_logo_wit.png" alt="Bureau Max">
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    let playerName = '';
    let currentState = null;
    let players = [];
    let categories = [];
    let myAnswers = {};
    let myBets = new Set(); // Question IDs we have bets on
    let betPlacedFromQuestion = -1; // Track which question we placed a bet from
    let hasVotedSkip = false;
    let skipVoteStatus = { skipVoteCount: 0, totalPlayers: 0, votesNeeded: 1 };

    function createEl(tag, className, text) {
      const el = document.createElement(tag);
      if (className) el.className = className;
      if (text) el.textContent = text;
      return el;
    }

    const path = window.location.pathname;
    const match = path.match(/\/quiz\/(.+)/);
    if (match && match[1] !== 'admin') {
      playerName = decodeURIComponent(match[1]);
      document.getElementById('playerNameDisplay').textContent = playerName;
      socket.emit('playerJoin', playerName);
    }

    // Re-emit playerJoin on reconnect (after server restart)
    socket.on('connect', () => {
      if (playerName) {
        socket.emit('playerJoin', playerName);
      }
    });

    // Update naam naar gekapitaliseerde versie van server
    socket.on('nameUpdated', (capitalized) => {
      playerName = capitalized;
      document.getElementById('playerNameDisplay').textContent = playerName;
    });

    socket.on('gameState', (state) => {
      currentState = state;
      if (state.currentQuestionIndex === 0) hasVotedSkip = false;
      render();
    });

    socket.on('playerUpdate', (playerData) => {
      players = playerData;
      const me = players.find(p => p.name === playerName);
      if (me) hasVotedSkip = me.hasVotedSkip;
      updateLeaderboard();
      // Re-render lobby to update player count
      if (currentState?.phase === 'lobby') render();
    });

    socket.on('categoryVotesUpdate', (cats) => {
      categories = cats;
      if (currentState?.phase === 'category-voting') render();
    });

    socket.on('skipVoteUpdate', (status) => {
      skipVoteStatus = status;
      if (currentState?.phase === 'playing') render();
    });

    socket.on('betPlaced', ({ questionId }) => {
      myBets.add(questionId);
      betPlacedFromQuestion = currentState?.currentQuestionIndex ?? -1;
      render();
    });

    function render() {
      const mainContent = document.getElementById('mainContent');
      const phaseBadge = document.getElementById('phaseBadge');
      const leaderboard = document.getElementById('leaderboard');

      if (!currentState) {
        mainContent.textContent = '';
        const w = createEl('div', 'waiting-screen');
        w.appendChild(createEl('h2', null, 'Verbinden...'));
        mainContent.appendChild(w);
        return;
      }

      // Toggle body class for playing phase (hides header)
      document.body.classList.toggle('playing', currentState.phase === 'playing');

      if (currentState.phase === 'lobby') {
        phaseBadge.textContent = '';
        phaseBadge.appendChild(createEl('div', 'phase-badge', 'Wachten op start'));
        leaderboard.style.display = 'none';
        renderLobby();
      } else if (currentState.phase === 'category-voting') {
        phaseBadge.textContent = '';
        phaseBadge.appendChild(createEl('div', 'phase-badge', 'CategorieÃ«n kiezen'));
        leaderboard.style.display = 'none';
        renderCategoryVoting();
      } else if (currentState.phase === 'playing') {
        phaseBadge.textContent = '';
        leaderboard.style.display = 'none';
        renderPlaying();
      } else if (currentState.phase === 'finished') {
        phaseBadge.textContent = '';
        leaderboard.style.display = 'block';
        renderFinished();
      }
    }

    function renderLobby() {
      const mainContent = document.getElementById('mainContent');
      mainContent.textContent = '';
      const w = createEl('div', 'waiting-screen');
      w.appendChild(createEl('h2', null, 'Wachten op start...'));
      w.appendChild(createEl('p', null, 'De quizmaster start zo het kiezen van categorieÃ«n!'));
      const count = createEl('p', null, players.length + ' spelers aangemeld');
      count.style.marginTop = '20px';
      count.style.color = 'var(--coral)';
      w.appendChild(count);
      mainContent.appendChild(w);
    }

    function renderCategoryVoting() {
      const mainContent = document.getElementById('mainContent');
      mainContent.textContent = '';

      const approvedCount = categories.filter(c => c.isApproved).length;

      const info = createEl('div', 'approved-info');
      info.appendChild(createEl('div', 'count', String(approvedCount)));
      info.appendChild(createEl('div', 'label', 'categorieÃ«n goedgekeurd'));
      mainContent.appendChild(info);

      const title = createEl('h2', null, 'Welke categorieÃ«n wil jij?');
      title.style.textAlign = 'center';
      title.style.marginBottom = '10px';
      title.style.fontFamily = 'Outfit, sans-serif';
      title.style.fontSize = '1.2rem';
      mainContent.appendChild(title);

      const hint = createEl('p', null, '3Ã— dezelfde categorie = toegevoegd!');
      hint.style.textAlign = 'center';
      hint.style.color = 'var(--gray-300)';
      hint.style.marginBottom = '20px';
      hint.style.fontSize = '0.9rem';
      mainContent.appendChild(hint);

      const row = createEl('div', 'category-input-row');
      const input = createEl('input', 'category-input');
      input.type = 'text';
      input.id = 'categoryInput';
      input.placeholder = 'Typ een categorie...';
      input.addEventListener('keypress', (e) => { if (e.key === 'Enter') suggestCategory(); });
      row.appendChild(input);

      const btn = createEl('button', 'add-category-btn', '+');
      btn.onclick = suggestCategory;
      row.appendChild(btn);
      mainContent.appendChild(row);

      const list = createEl('div', 'category-list');
      if (categories.length === 0) {
        list.appendChild(createEl('p', null, 'Nog geen categorieÃ«n voorgesteld'));
        list.style.textAlign = 'center';
        list.style.color = 'var(--gray-300)';
      } else {
        categories.forEach(cat => {
          const isMine = cat.suggesters.includes(playerName);
          const item = createEl('div', 'category-item' + (cat.isApproved ? ' approved' : '') + (isMine ? ' mine' : ''));

          const left = createEl('div');
          left.appendChild(createEl('div', 'category-name', cat.name));
          left.appendChild(createEl('div', 'suggesters', cat.suggesters.join(', ')));
          item.appendChild(left);

          const badge = createEl('span', 'count-badge' + (cat.isApproved ? ' approved' : ''),
            cat.suggesterCount + '/' + currentState.votesNeededForCategory);
          item.appendChild(badge);

          list.appendChild(item);
        });
      }
      mainContent.appendChild(list);
    }

    function suggestCategory() {
      const input = document.getElementById('categoryInput');
      const categoryName = input.value.trim();
      if (!categoryName) return;
      socket.emit('suggestCategory', { playerName, categoryName });
      input.value = '';
      input.focus();
    }

    function renderPlaying() {
      const mainContent = document.getElementById('mainContent');
      mainContent.textContent = '';

      if (!currentState.currentQuestion) {
        const w = createEl('div', 'waiting-screen');
        w.appendChild(createEl('h2', null, 'Volgende categorie...'));
        w.appendChild(createEl('p', null, 'Even geduld!'));
        mainContent.appendChild(w);
        return;
      }

      const questionId = currentState.currentQuestion.id;
      const myAnswer = myAnswers[questionId] || '';
      const hasSubmitted = myAnswer !== '';
      const hasBet = myBets.has(questionId);
      const me = players.find(p => p.name === playerName);
      const isLastCategory = currentState.currentCategoryIndex >= currentState.totalCategories - 1;

      // Minimal score + progress
      const scoreBar = createEl('div', 'score-display');
      scoreBar.appendChild(createEl('span', 'score', (me?.score || 0) + ' punten'));
      scoreBar.appendChild(createEl('span', 'progress',
        'Vraag ' + (currentState.currentQuestionIndex + 1) + '/' + currentState.currentCategory.questionCount));
      mainContent.appendChild(scoreBar);

      // Bet indicator - if you bet on THIS question from the previous one
      if (hasBet) {
        const betAlert = createEl('div', 'bet-alert');
        betAlert.textContent = 'Je hebt gegokt op deze vraag!';
        mainContent.appendChild(betAlert);
      }

      // Question card - clean
      const card = createEl('div', 'question-card');
      card.appendChild(createEl('div', 'question-text', currentState.currentQuestion.question));
      mainContent.appendChild(card);

      // Answer section
      const questionType = currentState.currentQuestion.type || 'text';
      const options = currentState.currentQuestion.options || [];

      if (!currentState.showAnswer) {
        if (questionType === 'multiple-choice' && options.length > 0) {
          // Multiple choice buttons
          const mcContainer = createEl('div', 'mc-options');
          const letters = ['A', 'B', 'C', 'D'];
          options.forEach((option, idx) => {
            const letter = letters[idx];
            const isSelected = myAnswer === letter;
            const btn = createEl('div', 'mc-option' + (isSelected ? ' selected' : '') + (hasSubmitted ? ' disabled' : ''));
            btn.appendChild(createEl('span', 'mc-letter', letter));
            btn.appendChild(createEl('span', 'mc-text', option));
            if (!hasSubmitted) {
              btn.onclick = () => selectMCOption(letter);
            }
            mcContainer.appendChild(btn);
          });
          mainContent.appendChild(mcContainer);

          if (hasSubmitted) {
            mainContent.appendChild(createEl('div', 'submitted-badge', hasBet ? '2Ã— ingezet!' : 'Verzonden'));
          }
        } else if (questionType === 'number') {
          // Number input
          const input = createEl('input', 'number-input');
          input.type = 'tel';
          input.inputMode = 'numeric';
          input.pattern = '[0-9]*';
          input.id = 'answerInput';
          input.placeholder = '?';
          input.value = myAnswer;
          if (hasSubmitted) input.readOnly = true;
          mainContent.appendChild(input);

          const submitBtn = createEl('button', 'submit-btn', hasSubmitted ? (hasBet ? '2Ã— ingezet!' : 'Verzonden') : 'Verzenden');
          submitBtn.disabled = hasSubmitted;
          submitBtn.onclick = submitAnswer;
          mainContent.appendChild(submitBtn);
        } else {
          // Text input (default)
          const input = createEl('input', 'answer-input');
          input.type = 'text';
          input.id = 'answerInput';
          input.placeholder = 'Typ je antwoord...';
          input.value = myAnswer;
          if (hasSubmitted) input.readOnly = true;
          mainContent.appendChild(input);

          const submitBtn = createEl('button', 'submit-btn', hasSubmitted ? (hasBet ? '2Ã— ingezet!' : 'Verzonden') : 'Verzenden');
          submitBtn.disabled = hasSubmitted;
          submitBtn.onclick = submitAnswer;
          mainContent.appendChild(submitBtn);
        }

        // Bottom action buttons
        const bottomActions = createEl('div', 'bottom-actions');
        const isLastQuestion = currentState.currentQuestionIndex >= currentState.currentCategory.questionCount - 1;

        // Bet button - bets on NEXT question (blind)
        const hasBetFromThisQuestion = betPlacedFromQuestion === currentState.currentQuestionIndex;
        const betBtn = createEl('button', 'bottom-btn bet-btn' + (hasBetFromThisQuestion ? ' placed' : ''));
        betBtn.textContent = hasBetFromThisQuestion ? 'Gegokt!' : 'Gok op volgende';
        betBtn.disabled = hasBetFromThisQuestion || isLastQuestion;
        betBtn.onclick = placeBet;
        bottomActions.appendChild(betBtn);

        // Skip button (only if not last category)
        if (!isLastCategory) {
          const skipBtn = createEl('button', 'bottom-btn skip-btn' + (hasVotedSkip ? ' voted' : ''));
          if (!skipVoteStatus.canSkipYet) {
            // Nog niet genoeg vragen beantwoord
            const remaining = skipVoteStatus.mandatoryQuestions - skipVoteStatus.questionsAnswered;
            skipBtn.textContent = 'Skip (nog ' + remaining + ' vraag' + (remaining > 1 ? 'en' : '') + ')';
            skipBtn.disabled = true;
          } else {
            skipBtn.textContent = 'Skip (' + skipVoteStatus.skipVoteCount + '/' + skipVoteStatus.votesNeeded + ')';
            skipBtn.onclick = toggleSkipVote;
          }
          bottomActions.appendChild(skipBtn);
        }

        mainContent.appendChild(bottomActions);
      } else {
        // Answer revealed - show result feedback if player submitted an answer
        const me = players.find(p => p.name === playerName);
        if (hasSubmitted && me) {
          const resultDiv = createEl('div', 'answer-result ' + (me.wasCorrect ? 'correct' : 'wrong'));
          resultDiv.appendChild(createEl('div', 'result-icon', me.wasCorrect ? 'ðŸŽ‰' : 'ðŸ˜…'));
          resultDiv.appendChild(createEl('div', 'result-text', me.wasCorrect ? 'Correct!' : 'Helaas!'));
          if (hasBet) {
            const pointsText = me.wasCorrect ? '+2 punten (dubbel!)' : '-1 punt (inzet verloren)';
            resultDiv.appendChild(createEl('div', 'result-points', pointsText));
          } else if (me.wasCorrect) {
            resultDiv.appendChild(createEl('div', 'result-points', '+1 punt'));
          }
          mainContent.appendChild(resultDiv);
        }

        const reveal = createEl('div', 'answer-reveal');
        reveal.appendChild(createEl('div', 'label', 'Het juiste antwoord:'));
        reveal.appendChild(createEl('div', 'correct-answer', currentState.currentQuestion.answer));
        mainContent.appendChild(reveal);

        if (questionType === 'multiple-choice' && options.length > 0) {
          // Show MC options with correct/wrong highlighting
          const mcContainer = createEl('div', 'mc-options');
          mcContainer.style.marginTop = '16px';
          const letters = ['A', 'B', 'C', 'D'];
          const correctAnswer = currentState.currentQuestion.answer;
          options.forEach((option, idx) => {
            const letter = letters[idx];
            const isCorrect = letter === correctAnswer;
            const wasSelected = myAnswer === letter;
            let classes = 'mc-option disabled';
            if (isCorrect) classes += ' correct';
            else if (wasSelected) classes += ' wrong';

            const btn = createEl('div', classes);
            btn.appendChild(createEl('span', 'mc-letter', letter));
            btn.appendChild(createEl('span', 'mc-text', option));
            mcContainer.appendChild(btn);
          });
          mainContent.appendChild(mcContainer);
        } else if (hasSubmitted) {
          const yours = createEl('div', 'your-answer');
          yours.appendChild(createEl('div', 'label', 'Jouw antwoord:'));
          yours.appendChild(createEl('div', 'text', myAnswer));
          mainContent.appendChild(yours);
        }

        // Bet result info removed - now shown in the result feedback banner above
      }

      if (!hasSubmitted && !currentState.showAnswer && questionType !== 'multiple-choice') {
        setTimeout(() => { const i = document.getElementById('answerInput'); if (i) i.focus(); }, 100);
      }
    }

    function selectMCOption(letter) {
      if (!currentState?.currentQuestion || currentState.showAnswer) return;
      const questionId = currentState.currentQuestion.id;
      myAnswers[questionId] = letter;
      socket.emit('submitAnswer', { playerName, questionId, answer: letter });
      render();
    }

    function renderFinished() {
      const mainContent = document.getElementById('mainContent');
      mainContent.textContent = '';

      const me = players.find(p => p.name === playerName);
      const rank = players.findIndex(p => p.name === playerName) + 1;

      const msg = createEl('div', 'finished-message');
      msg.appendChild(createEl('h2', null, 'Quiz Afgelopen!'));
      msg.appendChild(createEl('div', 'your-final-score', (me?.score || 0) + ' pts'));
      msg.appendChild(createEl('div', 'your-final-rank', 'Je eindigde op plaats #' + rank));
      mainContent.appendChild(msg);
    }

    function toggleSkipVote() {
      if (hasVotedSkip) {
        socket.emit('removeSkipVote', { playerName });
        hasVotedSkip = false;
      } else {
        socket.emit('voteSkipCategory', { playerName });
        hasVotedSkip = true;
      }
      render();
    }

    function placeBet() {
      if (!currentState?.currentQuestion || currentState.showAnswer) return;
      socket.emit('placeBet', { playerName });
    }

    function submitAnswer() {
      const input = document.getElementById('answerInput');
      const answer = input.value.trim();
      if (!answer || !currentState?.currentQuestion) return;
      const questionId = currentState.currentQuestion.id;
      myAnswers[questionId] = answer;
      socket.emit('submitAnswer', { playerName, questionId, answer });
      render();
    }

    function updateLeaderboard() {
      const list = document.getElementById('leaderboardList');
      list.textContent = '';

      players.slice(0, 10).forEach((player, index) => {
        const isYou = player.name === playerName;
        const hasBet = player.hasBetOnCurrent;

        const item = createEl('div', 'leaderboard-item' + (isYou ? ' you' : '') + (hasBet ? ' has-bet' : ''));
        item.appendChild(createEl('span', 'leaderboard-rank', (index + 1) + '.'));
        item.appendChild(createEl('span', 'leaderboard-name', player.name + (hasBet ? ' (2Ã—)' : '')));
        item.appendChild(createEl('span', 'leaderboard-score', player.score + ' pts'));
        list.appendChild(item);
      });
    }

    document.addEventListener('keypress', (e) => {
      if (e.key === 'Enter' && currentState?.phase === 'playing') submitAnswer();
    });

    render();
  </script>
</body>
</html>
