<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bureau Max Quiz</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700;800;900&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --navy: #212c65;
      --navy-dark: #1a2350;
      --navy-light: #2d3a7a;
      --coral: #ee6d4e;
      --coral-light: #f48970;
      --coral-dark: #d85a3c;
      --white: #ffffff;
      --gray-100: #f8f9fc;
      --gray-200: #e8ebf4;
      --gray-300: #c5cce0;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--navy);
      min-height: 100vh;
      color: var(--white);
      overflow: hidden;
      position: relative;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      opacity: 0.03;
      pointer-events: none;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
    }

    body::after {
      content: '';
      position: fixed;
      top: -50%;
      right: -30%;
      width: 80%;
      height: 100%;
      background: radial-gradient(ellipse at center, rgba(238, 109, 78, 0.15) 0%, transparent 60%);
      pointer-events: none;
    }

    .container {
      display: flex;
      flex-direction: column;
      height: 100vh;
      padding: 30px 50px;
      position: relative;
      z-index: 1;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 20px;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .logo {
      height: 50px;
      width: auto;
    }

    .brand-text {
      display: flex;
      flex-direction: column;
    }

    .brand-title {
      font-family: 'Outfit', sans-serif;
      font-size: 2rem;
      font-weight: 800;
      letter-spacing: -0.02em;
      background: linear-gradient(135deg, var(--white) 0%, var(--gray-200) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .brand-tagline {
      font-size: 0.85rem;
      color: var(--coral);
      font-weight: 500;
      letter-spacing: 0.1em;
      text-transform: uppercase;
    }

    .header-info {
      text-align: right;
    }

    .phase-badge {
      display: inline-block;
      padding: 12px 28px;
      background: var(--coral);
      border-radius: 50px;
      font-family: 'Outfit', sans-serif;
      font-size: 1rem;
      font-weight: 700;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      box-shadow: 0 4px 20px rgba(238, 109, 78, 0.4);
      animation: float 3s ease-in-out infinite;
    }

    .category-badge {
      display: inline-block;
      padding: 12px 28px;
      background: linear-gradient(135deg, var(--coral) 0%, var(--coral-dark) 100%);
      border-radius: 50px;
      font-family: 'Outfit', sans-serif;
      font-size: 1.1rem;
      font-weight: 700;
      letter-spacing: 0.03em;
      box-shadow: 0 4px 20px rgba(238, 109, 78, 0.4);
    }

    .question-info {
      font-size: 0.95rem;
      color: var(--gray-300);
      margin-top: 10px;
      font-weight: 500;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-5px); }
    }

    .main-content {
      flex: 1;
      display: flex;
      gap: 40px;
      min-height: 0;
    }

    .question-area {
      flex: 2.5;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    .waiting-screen {
      text-align: center;
      animation: fadeUp 0.6s ease-out;
    }

    .waiting-screen h2 {
      font-family: 'Outfit', sans-serif;
      font-size: 4rem;
      font-weight: 900;
      letter-spacing: -0.03em;
      margin-bottom: 20px;
      background: linear-gradient(135deg, var(--white) 0%, var(--gray-200) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .waiting-screen p {
      font-size: 1.4rem;
      color: var(--gray-300);
    }

    .join-box {
      display: flex;
      align-items: center;
      gap: 30px;
      margin-top: 40px;
      padding: 25px 35px;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 24px;
    }

    .qr-code {
      display: block;
      width: 140px;
      height: 140px;
      border-radius: 10px;
      flex-shrink: 0;
    }

    .join-url {
      font-family: 'Outfit', sans-serif;
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--coral);
      letter-spacing: -0.01em;
    }

    .player-count {
      margin-top: 40px;
      font-family: 'Outfit', sans-serif;
      font-size: 1.3rem;
      color: var(--coral);
      font-weight: 600;
    }

    .category-voting-display {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    .voting-header {
      text-align: center;
      margin-bottom: 60px;
    }

    .voting-header h2 {
      font-family: 'Outfit', sans-serif;
      font-size: 3.5rem;
      font-weight: 800;
      letter-spacing: -0.02em;
      color: var(--white);
      margin-bottom: 15px;
    }

    .voting-header .instruction {
      font-size: 1.2rem;
      color: var(--gray-300);
      font-weight: 500;
    }

    .voting-header .instruction span {
      color: var(--coral);
      font-weight: 700;
    }

    .categories-cloud {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      gap: 20px;
      max-width: 900px;
      min-height: 200px;
    }

    .category-bubble {
      padding: 18px 32px;
      border-radius: 50px;
      font-family: 'Outfit', sans-serif;
      font-size: 1.3rem;
      font-weight: 700;
      background: rgba(255, 255, 255, 0.06);
      border: 2px solid rgba(255, 255, 255, 0.12);
      color: var(--white);
      position: relative;
      animation: bubbleIn 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) both;
      transition: all 0.3s ease;
    }

    .category-bubble:hover {
      transform: scale(1.05);
      background: rgba(255, 255, 255, 0.1);
    }

    .category-bubble .vote-count {
      position: absolute;
      top: -8px;
      right: -8px;
      width: 32px;
      height: 32px;
      background: var(--navy-light);
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
      font-weight: 800;
      color: var(--gray-300);
    }

    .category-bubble.approved {
      background: linear-gradient(135deg, var(--coral) 0%, var(--coral-dark) 100%);
      border-color: var(--coral);
      box-shadow: 0 8px 30px rgba(238, 109, 78, 0.4);
      animation: bubbleIn 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) both, approvedGlow 2s ease-in-out infinite;
    }

    .category-bubble.approved .vote-count {
      background: var(--white);
      border-color: var(--white);
      color: var(--coral);
    }

    @keyframes bubbleIn {
      0% {
        opacity: 0;
        transform: scale(0.3) rotate(-10deg);
      }
      100% {
        opacity: 1;
        transform: scale(1) rotate(0deg);
      }
    }

    @keyframes approvedGlow {
      0%, 100% { box-shadow: 0 8px 30px rgba(238, 109, 78, 0.4); }
      50% { box-shadow: 0 8px 50px rgba(238, 109, 78, 0.6); }
    }

    .voting-empty {
      font-size: 1.4rem;
      color: var(--gray-300);
      opacity: 0.5;
      font-style: italic;
    }

    .voting-stats {
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 40px;
      padding: 20px 40px;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 20px;
    }

    .voting-stat {
      text-align: center;
    }

    .voting-stat-value {
      font-family: 'Outfit', sans-serif;
      font-size: 2.5rem;
      font-weight: 900;
      color: var(--coral);
    }

    .voting-stat-label {
      font-size: 0.85rem;
      color: var(--gray-300);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .question-card {
      background: rgba(255, 255, 255, 0.03);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 32px;
      padding: 70px 80px;
      width: 100%;
      text-align: center;
      animation: fadeUp 0.5s ease-out;
    }

    .question-text {
      font-family: 'Outfit', sans-serif;
      font-size: 3.2rem;
      font-weight: 700;
      line-height: 1.3;
      margin-bottom: 50px;
      letter-spacing: -0.02em;
      background: linear-gradient(135deg, var(--white) 0%, var(--gray-200) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .answer-text {
      font-family: 'Outfit', sans-serif;
      font-size: 2.5rem;
      font-weight: 800;
      color: var(--coral);
      padding: 35px 50px;
      background: rgba(238, 109, 78, 0.1);
      border: 2px solid rgba(238, 109, 78, 0.3);
      border-radius: 20px;
      animation: revealAnswer 0.6s ease-out;
    }

    @keyframes revealAnswer {
      0% { opacity: 0; transform: scale(0.9); }
      100% { opacity: 1; transform: scale(1); }
    }

    .answer-hidden {
      font-size: 1.3rem;
      color: var(--gray-300);
      font-style: italic;
      opacity: 0.6;
    }

    .sidebar {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 20px;
      min-width: 320px;
    }

    .current-category-sidebar {
      background: linear-gradient(135deg, var(--coral) 0%, var(--coral-dark) 100%);
      border-radius: 20px;
      padding: 22px;
      box-shadow: 0 8px 30px rgba(238, 109, 78, 0.3);
    }

    .current-category-name {
      font-family: 'Outfit', sans-serif;
      font-size: 1.6rem;
      font-weight: 800;
      color: var(--white);
      margin-bottom: 8px;
      letter-spacing: -0.01em;
    }

    .current-category-progress {
      font-size: 0.95rem;
      color: rgba(255, 255, 255, 0.85);
      font-weight: 500;
    }

    .players-area {
      flex: 1;
      background: rgba(255, 255, 255, 0.03);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 24px;
      padding: 25px;
      overflow-y: auto;
    }

    .players-area::-webkit-scrollbar {
      width: 6px;
    }

    .players-area::-webkit-scrollbar-track {
      background: transparent;
    }

    .players-area::-webkit-scrollbar-thumb {
      background: rgba(238, 109, 78, 0.3);
      border-radius: 3px;
    }

    .players-area h3 {
      font-family: 'Outfit', sans-serif;
      font-size: 1rem;
      font-weight: 700;
      margin-bottom: 18px;
      color: var(--gray-300);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      text-align: center;
    }

    .player-list {
      list-style: none;
    }

    .player-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 14px 16px;
      margin-bottom: 8px;
      background: rgba(255, 255, 255, 0.04);
      border-radius: 12px;
      font-size: 1rem;
      transition: all 0.2s ease;
    }

    .player-item:hover {
      background: rgba(255, 255, 255, 0.07);
    }

    .player-item.has-bet {
      border: 2px solid var(--coral);
      background: rgba(238, 109, 78, 0.1);
    }

    .player-item.correct {
      background: rgba(16, 185, 129, 0.2);
      border: 2px solid #10b981;
      animation: correctPop 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    .player-item.correct .player-name::after {
      content: '✓';
      margin-left: 8px;
      color: #10b981;
      font-weight: 800;
    }

    .player-item.correct .player-score {
      color: #10b981;
    }

    @keyframes correctPop {
      0% { transform: scale(1); }
      30% { transform: scale(1.15); }
      50% { transform: scale(0.95); }
      70% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    .player-item.wrong {
      opacity: 0.5;
    }

    .player-name {
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .bet-icon {
      font-family: 'Outfit', sans-serif;
      color: var(--coral);
      font-size: 0.8rem;
      font-weight: 800;
      padding: 2px 6px;
      background: rgba(238, 109, 78, 0.2);
      border-radius: 4px;
    }

    .player-score {
      font-family: 'Outfit', sans-serif;
      color: var(--coral);
      font-weight: 700;
      font-size: 1.1rem;
    }

    .player-status {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .player-answered {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
    }

    .player-answered.submitted {
      background: var(--coral);
      box-shadow: 0 0 10px var(--coral);
      animation: pulse 1.5s infinite;
    }

    .player-skip-vote {
      font-size: 0.7rem;
      font-weight: 700;
      color: var(--coral);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .categories-overview,
    .skip-vote-sidebar {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 20px;
      padding: 22px;
    }

    .categories-overview h3,
    .skip-vote-sidebar h3 {
      font-family: 'Outfit', sans-serif;
      font-size: 0.9rem;
      font-weight: 700;
      margin-bottom: 15px;
      color: var(--gray-300);
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    .skip-vote-sidebar h3 {
      color: var(--coral);
    }

    .skip-vote-sidebar.active {
      border-color: rgba(238, 109, 78, 0.4);
      background: rgba(238, 109, 78, 0.05);
    }

    .skip-vote-sidebar .skip-vote-progress {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .skip-vote-sidebar .skip-vote-progress .bar {
      flex: 1;
      height: 10px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 5px;
      overflow: hidden;
    }

    .skip-vote-sidebar .skip-vote-progress .bar .fill {
      height: 100%;
      background: linear-gradient(90deg, var(--coral) 0%, var(--coral-light) 100%);
      transition: width 0.4s ease;
    }

    .skip-vote-sidebar .skip-vote-progress .count {
      font-family: 'Outfit', sans-serif;
      font-size: 1rem;
      font-weight: 700;
      color: var(--coral);
      min-width: 50px;
      text-align: right;
    }

    .category-dots {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .category-dot {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'Outfit', sans-serif;
      font-size: 0.85rem;
      font-weight: 700;
      transition: all 0.3s ease;
    }

    .category-dot.current {
      background: var(--coral);
      color: var(--white);
      box-shadow: 0 4px 15px rgba(238, 109, 78, 0.4);
      transform: scale(1.1);
    }

    .category-dot.completed {
      background: rgba(238, 109, 78, 0.3);
      color: var(--coral);
    }

    .finished-screen {
      text-align: center;
      animation: fadeUp 0.6s ease-out;
    }

    .finished-screen h2 {
      font-family: 'Outfit', sans-serif;
      font-size: 4.5rem;
      font-weight: 900;
      margin-bottom: 60px;
      color: var(--coral);
      letter-spacing: -0.03em;
    }

    .final-scores {
      display: flex;
      justify-content: center;
      gap: 30px;
      flex-wrap: wrap;
      align-items: flex-end;
    }

    .score-card {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      padding: 35px 50px;
      border-radius: 24px;
      text-align: center;
      transition: all 0.3s ease;
    }

    .score-card.first {
      background: linear-gradient(135deg, var(--coral) 0%, var(--coral-dark) 100%);
      color: var(--white);
      transform: scale(1.15);
      box-shadow: 0 20px 60px rgba(238, 109, 78, 0.4);
    }

    .score-card .rank {
      font-family: 'Outfit', sans-serif;
      font-size: 2.5rem;
      font-weight: 900;
      margin-bottom: 10px;
      opacity: 0.6;
    }

    .score-card.first .rank {
      opacity: 1;
    }

    .score-card .name {
      font-family: 'Outfit', sans-serif;
      font-size: 1.5rem;
      font-weight: 700;
      letter-spacing: -0.01em;
    }

    .score-card .points {
      font-family: 'Outfit', sans-serif;
      font-size: 2.8rem;
      font-weight: 900;
      margin-top: 15px;
      color: var(--coral);
    }

    .score-card.first .points {
      color: var(--white);
    }

    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    /* Multiple Choice Options Display */
    .mc-options-display {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      margin-top: 40px;
      width: 100%;
      max-width: 900px;
    }

    .mc-option-display {
      display: flex;
      align-items: center;
      gap: 20px;
      padding: 25px 30px;
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid rgba(255, 255, 255, 0.1);
      border-radius: 18px;
      transition: all 0.3s ease;
    }

    .mc-option-display.correct {
      background: rgba(16, 185, 129, 0.2);
      border-color: #10b981;
      box-shadow: 0 0 30px rgba(16, 185, 129, 0.3);
    }

    .mc-option-display.wrong {
      opacity: 0.4;
    }

    .mc-letter-display {
      width: 55px;
      height: 55px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 14px;
      font-family: 'Outfit', sans-serif;
      font-weight: 800;
      font-size: 1.5rem;
      flex-shrink: 0;
    }

    .mc-option-display.correct .mc-letter-display {
      background: #10b981;
    }

    .mc-text-display {
      font-family: 'Outfit', sans-serif;
      font-size: 1.4rem;
      font-weight: 600;
      line-height: 1.3;
    }

    /* Question type badge */
    .question-type-display {
      display: inline-block;
      padding: 8px 16px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      font-size: 0.8rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--gray-300);
      margin-bottom: 20px;
    }

    .question-type-display.mc { background: rgba(238, 109, 78, 0.2); color: var(--coral); }
    .question-type-display.number { background: rgba(59, 130, 246, 0.2); color: #3b82f6; }
    .question-type-display.music { background: rgba(168, 85, 247, 0.2); color: #a855f7; }
    .question-type-display.video { background: rgba(245, 158, 11, 0.2); color: #f59e0b; }

    /* Music Player */
    .music-player {
      margin-top: 40px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
    }

    .music-play-btn {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: linear-gradient(135deg, #a855f7 0%, #7c3aed 100%);
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 10px 40px rgba(168, 85, 247, 0.4);
      transition: all 0.3s ease;
    }

    .music-play-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 15px 50px rgba(168, 85, 247, 0.5);
    }

    .music-play-btn.playing {
      animation: musicPulse 1s ease-in-out infinite;
    }

    .music-play-btn svg {
      width: 50px;
      height: 50px;
      fill: white;
    }

    @keyframes musicPulse {
      0%, 100% { transform: scale(1); box-shadow: 0 10px 40px rgba(168, 85, 247, 0.4); }
      50% { transform: scale(1.08); box-shadow: 0 15px 60px rgba(168, 85, 247, 0.6); }
    }

    .music-info {
      font-size: 1.1rem;
      color: var(--gray-300);
    }

    .music-answer-reveal {
      margin-top: 30px;
      padding: 30px 50px;
      background: rgba(168, 85, 247, 0.15);
      border: 2px solid rgba(168, 85, 247, 0.4);
      border-radius: 20px;
      text-align: center;
    }

    .music-answer-reveal .song-title {
      font-family: 'Outfit', sans-serif;
      font-size: 2.2rem;
      font-weight: 800;
      color: #a855f7;
      margin-bottom: 8px;
    }

    .music-answer-reveal .artist {
      font-size: 1.3rem;
      color: var(--gray-300);
    }

    /* Video/Film Answer Reveal */
    .video-answer-reveal {
      margin-top: 30px;
      padding: 30px 50px;
      background: rgba(245, 158, 11, 0.15);
      border: 2px solid rgba(245, 158, 11, 0.4);
      border-radius: 20px;
      text-align: center;
    }

    .video-answer-reveal .film-title {
      font-family: 'Outfit', sans-serif;
      font-size: 2.2rem;
      font-weight: 800;
      color: #f59e0b;
      margin-bottom: 8px;
    }

    .video-answer-reveal .film-source {
      font-size: 1.3rem;
      color: var(--gray-300);
    }

    .video-answer-reveal .clip-quote {
      font-size: 1.1rem;
      font-style: italic;
      color: var(--gray-300);
      margin-top: 10px;
      opacity: 0.8;
    }

    .youtube-embed {
      margin-top: 30px;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
    }

    /* Image questions */
    .question-type-display.image {
      background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
    }

    .image-container {
      margin-top: 30px;
      text-align: center;
    }

    .image-container img {
      max-width: 100%;
      max-height: 450px;
      border-radius: 16px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
      object-fit: contain;
    }

    .image-credit {
      font-size: 0.85rem;
      color: var(--gray-400);
      margin-top: 10px;
      font-style: italic;
    }

    .image-answer-reveal {
      margin-top: 30px;
      padding: 30px 50px;
      background: rgba(6, 182, 212, 0.15);
      border: 2px solid rgba(6, 182, 212, 0.4);
      border-radius: 20px;
      text-align: center;
    }

    .image-answer-reveal .answer-title {
      font-family: 'Outfit', sans-serif;
      font-size: 2.2rem;
      font-weight: 800;
      color: #06b6d4;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <img src="/bureau_max_logo_wit.png" alt="Bureau Max" class="logo">
        <div class="brand-text">
          <div class="brand-title">Quiz Night</div>
          <div class="brand-tagline">Digital Storytellers</div>
        </div>
      </div>
      <div class="header-info">
        <div id="phaseBadge"></div>
        <div class="question-info" id="questionInfo"></div>
      </div>
    </header>

    <div class="main-content">
      <div class="question-area" id="questionArea"></div>

      <div class="sidebar">
        <div class="current-category-sidebar" id="currentCategorySidebar" style="display: none;">
          <div class="current-category-name" id="currentCategoryName"></div>
          <div class="current-category-progress" id="currentCategoryProgress"></div>
        </div>

        <div class="players-area">
          <h3>Spelers</h3>
          <ul class="player-list" id="playerList"></ul>
        </div>

        <div class="categories-overview" id="categoriesOverview">
          <h3>Categorieën</h3>
          <div class="category-dots" id="categoryDots"></div>
        </div>

        <div class="skip-vote-sidebar" id="skipVoteSidebar" style="display: none;">
          <h3>Skip categorie</h3>
          <div class="skip-vote-progress">
            <div class="bar">
              <div class="fill" id="skipVoteFill"></div>
            </div>
            <div class="count" id="skipVoteCount">0 / 2</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    let currentState = null;
    let players = [];
    let categories = [];
    let skipVoteStatus = { skipVoteCount: 0, totalPlayers: 0, votesNeeded: 1 };

    // Helper to safely set text content
    function setText(el, text) {
      if (el) el.textContent = text;
    }

    // Helper to create element with text
    function createEl(tag, className, text) {
      const el = document.createElement(tag);
      if (className) el.className = className;
      if (text) el.textContent = text;
      return el;
    }

    socket.on('gameState', (state) => {
      currentState = state;
      render();
    });

    socket.on('playerUpdate', (playerData) => {
      players = playerData;
      renderPlayers();
      // Update lobby player count if in lobby
      const lobbyCount = document.querySelector('.player-count');
      if (lobbyCount && currentState?.phase === 'lobby') {
        lobbyCount.textContent = players.length + ' spelers aangemeld';
      }
    });

    socket.on('categoryVotesUpdate', (cats) => {
      categories = cats;
      if (currentState?.phase === 'category-voting') {
        render();
      }
    });

    socket.on('skipVoteUpdate', (status) => {
      skipVoteStatus = status;
      if (currentState?.phase === 'playing') {
        updateSkipVoteSidebar();
      }
    });

    function render() {
      const questionArea = document.getElementById('questionArea');
      const phaseBadge = document.getElementById('phaseBadge');
      const questionInfo = document.getElementById('questionInfo');
      const categoriesOverview = document.getElementById('categoriesOverview');
      const skipVoteSidebar = document.getElementById('skipVoteSidebar');
      const currentCategorySidebar = document.getElementById('currentCategorySidebar');
      const sidebar = document.querySelector('.sidebar');

      if (!currentState) {
        questionArea.textContent = '';
        const waiting = createEl('div', 'waiting-screen');
        waiting.appendChild(createEl('h2', null, 'Verbinden...'));
        questionArea.appendChild(waiting);
        return;
      }

      if (currentState.phase === 'lobby') {
        phaseBadge.textContent = '';
        questionInfo.textContent = '';
        sidebar.style.display = 'flex';
        categoriesOverview.style.display = 'none';
        skipVoteSidebar.style.display = 'none';
        currentCategorySidebar.style.display = 'none';
        renderLobby();
      } else if (currentState.phase === 'category-voting') {
        phaseBadge.textContent = '';
        const badge = createEl('div', 'phase-badge', 'Categorieën Kiezen');
        phaseBadge.appendChild(badge);
        questionInfo.textContent = '';
        sidebar.style.display = 'none';
        renderCategoryVoting();
      } else if (currentState.phase === 'playing') {
        phaseBadge.textContent = '';
        questionInfo.textContent = '';
        sidebar.style.display = 'flex';
        categoriesOverview.style.display = 'block';
        currentCategorySidebar.style.display = 'block';
        updateCurrentCategorySidebar();
        renderPlaying();
      } else if (currentState.phase === 'finished') {
        phaseBadge.textContent = '';
        questionInfo.textContent = '';
        sidebar.style.display = 'flex';
        categoriesOverview.style.display = 'block';
        skipVoteSidebar.style.display = 'none';
        currentCategorySidebar.style.display = 'none';
        renderFinished();
      }
    }

    function updateCurrentCategorySidebar() {
      const nameEl = document.getElementById('currentCategoryName');
      const progressEl = document.getElementById('currentCategoryProgress');

      if (currentState?.currentCategory) {
        nameEl.textContent = currentState.currentCategory.name;
        progressEl.textContent = 'Vraag ' + (currentState.currentQuestionIndex + 1) + ' van ' + currentState.currentCategory.questionCount + ' · Categorie ' + (currentState.currentCategoryIndex + 1) + ' van ' + currentState.totalCategories;
      }
    }

    const JOIN_URL = 'http://192.168.0.42:3001/quiz/start';

    function renderLobby() {
      const questionArea = document.getElementById('questionArea');
      questionArea.textContent = '';

      const screen = createEl('div', 'waiting-screen');
      screen.appendChild(createEl('h2', null, 'Welkom!'));
      screen.appendChild(createEl('p', null, 'Doe mee op je telefoon:'));

      // QR Code + URL box
      const joinBox = createEl('div', 'join-box');
      const qrImg = document.createElement('img');
      qrImg.src = 'https://api.qrserver.com/v1/create-qr-code/?size=140x140&bgcolor=212c65&color=ffffff&data=' + encodeURIComponent(JOIN_URL);
      qrImg.alt = 'Scan om mee te doen';
      qrImg.className = 'qr-code';
      joinBox.appendChild(qrImg);

      const url = createEl('div', 'join-url', JOIN_URL);
      joinBox.appendChild(url);
      screen.appendChild(joinBox);

      const count = createEl('div', 'player-count', players.length + ' spelers aangemeld');
      screen.appendChild(count);

      questionArea.appendChild(screen);
    }

    function renderCategoryVoting() {
      const questionArea = document.getElementById('questionArea');
      questionArea.textContent = '';

      const approvedCount = categories.filter(c => c.isApproved).length;
      const totalSuggestions = categories.length;

      const container = createEl('div', 'category-voting-display');

      // Header
      const header = createEl('div', 'voting-header');
      header.appendChild(createEl('h2', null, 'Kies je categorieën'));
      const instruction = createEl('div', 'instruction');
      instruction.innerHTML = 'Typ een categorie op je telefoon — <span>3 stemmen</span> = toegevoegd!';
      header.appendChild(instruction);
      container.appendChild(header);

      // Categories cloud
      const cloud = createEl('div', 'categories-cloud');

      if (categories.length === 0) {
        cloud.appendChild(createEl('div', 'voting-empty', 'Wachten op suggesties...'));
      } else {
        // Sort: approved first, then by vote count
        const sortedCats = [...categories].sort((a, b) => {
          if (a.isApproved !== b.isApproved) return b.isApproved ? 1 : -1;
          return b.suggesterCount - a.suggesterCount;
        });

        sortedCats.forEach((cat, index) => {
          const bubble = createEl('div', 'category-bubble' + (cat.isApproved ? ' approved' : ''));
          bubble.style.animationDelay = (index * 0.05) + 's';
          bubble.appendChild(document.createTextNode(cat.name));

          const voteCount = createEl('span', 'vote-count', String(cat.suggesterCount));
          bubble.appendChild(voteCount);

          cloud.appendChild(bubble);
        });
      }

      container.appendChild(cloud);

      // Stats bar at bottom
      const stats = createEl('div', 'voting-stats');

      const statApproved = createEl('div', 'voting-stat');
      statApproved.appendChild(createEl('div', 'voting-stat-value', String(approvedCount)));
      statApproved.appendChild(createEl('div', 'voting-stat-label', 'Goedgekeurd'));
      stats.appendChild(statApproved);

      const statTotal = createEl('div', 'voting-stat');
      statTotal.appendChild(createEl('div', 'voting-stat-value', String(totalSuggestions)));
      statTotal.appendChild(createEl('div', 'voting-stat-label', 'Suggesties'));
      stats.appendChild(statTotal);

      const statPlayers = createEl('div', 'voting-stat');
      statPlayers.appendChild(createEl('div', 'voting-stat-value', String(players.length)));
      statPlayers.appendChild(createEl('div', 'voting-stat-label', 'Spelers'));
      stats.appendChild(statPlayers);

      container.appendChild(stats);
      questionArea.appendChild(container);
    }

    function renderPlaying() {
      const questionArea = document.getElementById('questionArea');
      questionArea.textContent = '';

      renderCategoryDots();

      if (!currentState.currentQuestion) {
        const screen = createEl('div', 'waiting-screen');
        screen.appendChild(createEl('h2', null, 'Quiz Afgelopen!'));
        questionArea.appendChild(screen);
        return;
      }

      const questionType = currentState.currentQuestion.type || 'text';
      const options = currentState.currentQuestion.options || [];

      const card = createEl('div', 'question-card');

      // Show question type badge
      if (questionType === 'multiple-choice') {
        card.appendChild(createEl('div', 'question-type-display mc', 'Multiple Choice'));
      } else if (questionType === 'number') {
        card.appendChild(createEl('div', 'question-type-display number', 'Getal'));
      } else if (questionType === 'music') {
        card.appendChild(createEl('div', 'question-type-display music', 'Muziek'));
      } else if (questionType === 'video') {
        card.appendChild(createEl('div', 'question-type-display video', 'Film'));
      } else if (questionType === 'image') {
        card.appendChild(createEl('div', 'question-type-display image', 'Afbeelding'));
      }

      card.appendChild(createEl('div', 'question-text', currentState.currentQuestion.question));

      // Show music player (no YouTube embed - admin plays from their panel)
      if (questionType === 'music') {
        if (!currentState.showAnswer) {
          const musicPlayer = createEl('div', 'music-player');
          const playBtn = createEl('button', 'music-play-btn');
          playBtn.innerHTML = '<svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>';
          musicPlayer.appendChild(playBtn);
          musicPlayer.appendChild(createEl('div', 'music-info', 'Luister naar het fragment...'));
          card.appendChild(musicPlayer);
        }

        // Show answer
        if (currentState.showAnswer) {
          const answerReveal = createEl('div', 'music-answer-reveal');
          answerReveal.appendChild(createEl('div', 'song-title', currentState.currentQuestion.songTitle || currentState.currentQuestion.answer));
          if (currentState.currentQuestion.artist) {
            answerReveal.appendChild(createEl('div', 'artist', currentState.currentQuestion.artist));
          }
          card.appendChild(answerReveal);
        }
      }
      // Show video/film player (no YouTube embed - admin plays from their panel)
      else if (questionType === 'video') {
        if (!currentState.showAnswer) {
          const videoPlayer = createEl('div', 'music-player');
          const playBtn = createEl('button', 'music-play-btn');
          playBtn.style.background = 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)';
          playBtn.innerHTML = '<svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>';
          videoPlayer.appendChild(playBtn);
          videoPlayer.appendChild(createEl('div', 'music-info', 'Kijk naar het fragment...'));
          card.appendChild(videoPlayer);
        }

        // Show answer
        if (currentState.showAnswer) {
          const answerReveal = createEl('div', 'video-answer-reveal');
          answerReveal.appendChild(createEl('div', 'film-title', currentState.currentQuestion.answer));
          if (currentState.currentQuestion.source) {
            answerReveal.appendChild(createEl('div', 'film-source', currentState.currentQuestion.source));
          }
          if (currentState.currentQuestion.clipTitle) {
            answerReveal.appendChild(createEl('div', 'clip-quote', currentState.currentQuestion.clipTitle));
          }
          card.appendChild(answerReveal);
        }
      }
      // Show image
      else if (questionType === 'image') {
        const imageUrl = currentState.currentQuestion.imageUrl;
        if (imageUrl) {
          const imageContainer = createEl('div', 'image-container');
          const img = document.createElement('img');
          img.src = imageUrl;
          img.alt = 'Quiz afbeelding';
          imageContainer.appendChild(img);
          if (currentState.currentQuestion.imageCredit) {
            imageContainer.appendChild(createEl('div', 'image-credit', currentState.currentQuestion.imageCredit));
          }
          card.appendChild(imageContainer);
        }

        // Show answer
        if (currentState.showAnswer) {
          const answerReveal = createEl('div', 'image-answer-reveal');
          answerReveal.appendChild(createEl('div', 'answer-title', currentState.currentQuestion.answer));
          card.appendChild(answerReveal);
        }
      }
      // Show MC options
      else if (questionType === 'multiple-choice' && options.length > 0) {
        const mcContainer = createEl('div', 'mc-options-display');
        const letters = ['A', 'B', 'C', 'D'];
        const correctAnswer = currentState.currentQuestion.answer;

        options.forEach((option, idx) => {
          const letter = letters[idx];
          const isCorrect = letter === correctAnswer;
          let classes = 'mc-option-display';
          if (currentState.showAnswer) {
            classes += isCorrect ? ' correct' : ' wrong';
          }

          const optionEl = createEl('div', classes);
          optionEl.appendChild(createEl('span', 'mc-letter-display', letter));
          optionEl.appendChild(createEl('span', 'mc-text-display', option));
          mcContainer.appendChild(optionEl);
        });

        card.appendChild(mcContainer);
      } else if (currentState.showAnswer && currentState.currentQuestion.answer) {
        card.appendChild(createEl('div', 'answer-text', currentState.currentQuestion.answer));
      } else if (!currentState.showAnswer) {
        card.appendChild(createEl('div', 'answer-hidden', 'Antwoord verborgen'));
      }

      questionArea.appendChild(card);

      // Update skip vote sidebar
      updateSkipVoteSidebar();
    }

    function updateSkipVoteSidebar() {
      const sidebar = document.getElementById('skipVoteSidebar');
      const fill = document.getElementById('skipVoteFill');
      const count = document.getElementById('skipVoteCount');

      if (skipVoteStatus.totalPlayers > 0 && currentState?.phase === 'playing') {
        sidebar.style.display = 'block';
        const percentage = (skipVoteStatus.skipVoteCount / skipVoteStatus.votesNeeded) * 100;
        fill.style.width = Math.min(percentage, 100) + '%';
        count.textContent = skipVoteStatus.skipVoteCount + ' / ' + skipVoteStatus.votesNeeded;

        if (skipVoteStatus.skipVoteCount > 0) {
          sidebar.classList.add('active');
        } else {
          sidebar.classList.remove('active');
        }
      } else {
        sidebar.style.display = 'none';
      }
    }

    function renderCategoryDots() {
      const dots = document.getElementById('categoryDots');
      dots.textContent = '';

      if (!currentState || currentState.totalCategories === 0) return;

      for (let i = 0; i < currentState.totalCategories; i++) {
        let className = 'category-dot';
        if (i < currentState.currentCategoryIndex) {
          className += ' completed';
        } else if (i === currentState.currentCategoryIndex) {
          className += ' current';
        }
        dots.appendChild(createEl('div', className, String(i + 1)));
      }
    }

    function renderFinished() {
      const questionArea = document.getElementById('questionArea');
      questionArea.textContent = '';

      const sortedPlayers = [...players].sort((a, b) => b.score - a.score);

      const screen = createEl('div', 'finished-screen');
      screen.appendChild(createEl('h2', null, 'Quiz Afgelopen!'));

      const scores = createEl('div', 'final-scores');

      sortedPlayers.slice(0, 5).forEach((player, index) => {
        const card = createEl('div', 'score-card' + (index === 0 ? ' first' : ''));
        card.appendChild(createEl('div', 'rank', '#' + (index + 1)));
        card.appendChild(createEl('div', 'name', player.name));
        card.appendChild(createEl('div', 'points', player.score + ' pts'));
        scores.appendChild(card);
      });

      screen.appendChild(scores);
      questionArea.appendChild(screen);
    }

    function renderPlayers() {
      const playerList = document.getElementById('playerList');
      playerList.textContent = '';

      players.forEach(player => {
        const hasAnswered = player.currentAnswer !== undefined && player.currentAnswer !== null;

        let classes = 'player-item';
        if (player.hasBetOnCurrent) classes += ' has-bet';
        if (currentState?.showAnswer && hasAnswered) {
          classes += player.wasCorrect ? ' correct' : ' wrong';
        }
        const li = createEl('li', classes);

        const nameSpan = createEl('span', 'player-name');
        if (player.hasBetOnCurrent) {
          nameSpan.appendChild(createEl('span', 'bet-icon', '2×'));
        }
        nameSpan.appendChild(document.createTextNode(player.name));
        li.appendChild(nameSpan);

        const status = createEl('span', 'player-status');
        if (player.hasVotedSkip) {
          status.appendChild(createEl('span', 'player-skip-vote', 'SKIP'));
        }
        status.appendChild(createEl('span', 'player-score', String(player.score)));
        status.appendChild(createEl('span', 'player-answered' + (hasAnswered ? ' submitted' : '')));
        li.appendChild(status);

        playerList.appendChild(li);
      });
    }

    render();
  </script>
</body>
</html>
